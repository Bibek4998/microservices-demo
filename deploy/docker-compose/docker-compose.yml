version: "3.8"

# Lightweight Sock Shop setup
# EC2-safe: frontend + edge-router + one backend + one DB

services:
  edge-router:
    image: weaveworksdemos/edge-router:0.1.1
    container_name: edge-router
    ports:
      - "80:80"
    restart: unless-stopped
    cap_drop:
      - ALL

  front-end:
    image: weaveworksdemos/front-end:0.3.12
    container_name: front-end
    depends_on:
      - edge-router
    restart: unless-stopped
    cap_drop:
      - ALL
    read_only: true

  catalogue:
    image: weaveworksdemos/catalogue:0.3.5
    container_name: catalogue
    depends_on:
      - catalogue-db
    restart: unless-stopped
    cap_drop:
      - ALL
    cap_add:
      - NET_BIND_SERVICE
    read_only: true

  catalogue-db:
    image: weaveworksdemos/catalogue-db:0.3.0
    container_name: catalogue-db
    restart: unless-stopped
    environment:
      MYSQL_ALLOW_EMPTY_PASSWORD: "true"
      MYSQL_DATABASE: socksdb
